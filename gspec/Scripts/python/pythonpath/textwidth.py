"""Модуль для вычисления ширины текста."""

CHARWIDTH_MM_PER_POINT = {
    '\r': 0,
    '\n': 0,
    ' ': 0.12481698389458273,
    '!': 0.061273792093704246,
    '"': 0.09304538799414348,
    '#': 0.18609077598828697,
    '$': 0.16566617862371888,
    '%': 0.3109077598828697,
    '&': 0.18609077598828697,
    '\'': 0.052196193265007323,
    '(': 0.08396778916544656,
    ')': 0.08396778916544656,
    '*': 0.10439238653001465,
    '+': 0.14524158125915082,
    ',': 0.061273792093704246,
    '-': 0.14524158125915082,
    '.': 0.061273792093704246,
    '/': 0.16566617862371888,
    '0': 0.14524158125915082,
    '1': 0.09304538799414348,
    '2': 0.14524158125915082,
    '3': 0.14524158125915082,
    '4': 0.14524158125915082,
    '5': 0.14524158125915082,
    '6': 0.14524158125915082,
    '7': 0.14524158125915082,
    '8': 0.14524158125915082,
    '9': 0.14524158125915082,
    ':': 0.061273792093704246,
    ';': 0.061273792093704246,
    '<': 0.14524158125915082,
    '=': 0.14524158125915082,
    '>': 0.14524158125915082,
    '?': 0.14524158125915082,
    '@': 0.2700585651537335,
    'A': 0.16566617862371888,
    'B': 0.16112737920937042,
    'C': 0.13843338213762812,
    'D': 0.16339677891654467,
    'E': 0.14070278184480234,
    'F': 0.14070278184480234,
    'G': 0.16339677891654467,
    'H': 0.16566617862371888,
    'I': 0.061273792093704246,
    'J': 0.11120058565153734,
    'K': 0.16112737920937042,
    'L': 0.13389458272327967,
    'M': 0.18609077598828697,
    'N': 0.16566617862371888,
    'O': 0.16112737920937042,
    'P': 0.16112737920937042,
    'Q': 0.16339677891654467,
    'R': 0.16112737920937042,
    'S': 0.1588579795021962,
    'T': 0.14524158125915082,
    'U': 0.16566617862371888,
    'V': 0.16566617862371888,
    'W': 0.2087847730600293,
    'X': 0.17020497803806733,
    'Y': 0.16566617862371888,
    'Z': 0.1588579795021962,
    '[': 0.08396778916544656,
    '\\': 0.16566617862371888,
    ']': 0.08396778916544656,
    '^': 0.10439238653001465,
    '_': 0.18609077598828697,
    '`': 0.052196193265007323,
    'a': 0.14978038067349927,
    'b': 0.14297218155197658,
    'c': 0.11800878477306004,
    'd': 0.14297218155197658,
    'e': 0.14070278184480234,
    'f': 0.09531478770131771,
    'g': 0.14297218155197658,
    'h': 0.14524158125915082,
    'i': 0.061273792093704246,
    'j': 0.061273792093704246,
    'k': 0.14070278184480234,
    'l': 0.08169838945827233,
    'm': 0.18609077598828697,
    'n': 0.14524158125915082,
    'o': 0.14070278184480234,
    'p': 0.14297218155197658,
    'q': 0.14297218155197658,
    'r': 0.11346998535871157,
    's': 0.14070278184480234,
    't': 0.09531478770131771,
    'u': 0.14524158125915082,
    'v': 0.1293557833089312,
    'w': 0.17020497803806733,
    'x': 0.13389458272327967,
    'y': 0.1316251830161054,
    'z': 0.13389458272327967,
    '{': 0.10439238653001465,
    '|': 0.061273792093704246,
    '}': 0.10439238653001465,
    '~': 0.16566617862371888,
    '«': 0.14524158125915082,
    '°': 0.12481698389458273,
    '±': 0.14524158125915082,
    'µ': 0.15204978038067352,
    '·': 0.061273792093704246,
    '»': 0.14524158125915082,
    'А': 0.16566617862371888,
    'Б': 0.16112737920937042,
    'В': 0.16112737920937042,
    'Г': 0.13389458272327967,
    'Д': 0.15658857979502197,
    'Е': 0.14070278184480234,
    'Ж': 0.19062957540263542,
    'З': 0.13389458272327967,
    'И': 0.16566617862371888,
    'Й': 0.16566617862371888,
    'К': 0.16112737920937042,
    'Л': 0.1588579795021962,
    'М': 0.18609077598828697,
    'Н': 0.16566617862371888,
    'О': 0.16112737920937042,
    'П': 0.16566617862371888,
    'Р': 0.16112737920937042,
    'С': 0.13843338213762812,
    'Т': 0.14524158125915082,
    'У': 0.16339677891654467,
    'Ф': 0.18609077598828697,
    'Х': 0.17020497803806733,
    'Ц': 0.17247437774524157,
    'Ч': 0.16339677891654467,
    'Ш': 0.2087847730600293,
    'Щ': 0.21332357247437772,
    'Ъ': 0.18836017569546123,
    'Ы': 0.18609077598828697,
    'Ь': 0.16112737920937042,
    'Э': 0.1588579795021962,
    'Ю': 0.18382137628111272,
    'Я': 0.16112737920937042,
    'а': 0.14978038067349927,
    'б': 0.14070278184480234,
    'в': 0.14297218155197658,
    'г': 0.14070278184480234,
    'д': 0.14297218155197658,
    'е': 0.14070278184480234,
    'ж': 0.17474377745241582,
    'з': 0.11800878477306004,
    'и': 0.14524158125915082,
    'й': 0.14524158125915082,
    'к': 0.14070278184480234,
    'л': 0.13389458272327967,
    'м': 0.16566617862371888,
    'н': 0.14524158125915082,
    'о': 0.14070278184480234,
    'п': 0.14524158125915082,
    'р': 0.14297218155197658,
    'с': 0.11800878477306004,
    'т': 0.18609077598828697,
    'у': 0.14524158125915082,
    'ф': 0.17928257686676427,
    'х': 0.13389458272327967,
    'ц': 0.15204978038067352,
    'ч': 0.14297218155197658,
    'ш': 0.18609077598828697,
    'щ': 0.1928989751098097,
    'ъ': 0.14524158125915082,
    'ы': 0.16566617862371888,
    'ь': 0.13843338213762812,
    'э': 0.13843338213762812,
    'ю': 0.16339677891654467,
    'я': 0.14297218155197658,
    'Ё': 0.14070278184480234,
    'Є': 0.1588579795021962,
    'І': 0.061273792093704246,
    'Ї': 0.08396778916544656,
    'ё': 0.14070278184480234,
    'є': 0.13843338213762812,
    'і': 0.061273792093704246,
    'ї': 0.08396778916544656,
    '―': 0.35402635431918006,
    '…': 0.14524158125915082,
    '℃': 0.24963396778916547,
    '℉': 0.24963396778916547,
    '№': 0.24963396778916547,
    "min": 0.052196193265007323,
    "max": 0.35402635431918006,
}

def getWidthFactor(text, size, width):
    """Масштаб шрифта.

    Рассчитать масштаб шрифта в процентах, необходимый для размещения
    текст с указанным размером шрифта в графе заданной ширины.

    Аргументы:
    text (str) -- текст, который необходимо поместить в графу;
    size (int) -- размер шрифта в пунктах;
    width (float) -- ширина графы в мм.

    Возвращаемое значение (int) -- соотношение ширины графы к ширине текста.

    """
    if not text:
        return 100
    textWidth = 0
    for char in text:
        if char in CHARWIDTH_MM_PER_POINT:
            textWidth += CHARWIDTH_MM_PER_POINT[char]
        else:
            textWidth += CHARWIDTH_MM_PER_POINT["max"]
    # Ширина текста измеряется с небольшой погрешностью.
    # Чтобы текст гарантировано поместился в графе,
    # достаточно добавить ширину наименьшего символа.
    textWidth += CHARWIDTH_MM_PER_POINT["min"]
    textWidth *= size
    widthFactor = int((100 * width) / textWidth)
    widthFactor = max(widthFactor, 1)
    widthFactor = min(widthFactor, 100)
    return widthFactor
