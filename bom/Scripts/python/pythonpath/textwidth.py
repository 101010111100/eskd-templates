"""Модуль для вычисления ширины текста."""

def init(scriptcontext):
    pass

CHARWIDTH_MM_PER_POINT = {
    '\r': 0,
    '\n': 0,
    ' ': 0.124816983895,
    '!': 0.0612737920937,
    '"': 0.0930453879941,
    '#': 0.186090775988,
    '$': 0.165666178624,
    '%': 0.310907759883,
    '&': 0.186090775988,
    '\'': 0.052196193265,
    '(': 0.0839677891654,
    ')': 0.0839677891654,
    '*': 0.10439238653,
    '+': 0.145241581259,
    ',': 0.0612737920937,
    '-': 0.145241581259,
    '.': 0.0612737920937,
    '/': 0.165666178624,
    '0': 0.145241581259,
    '1': 0.0930453879941,
    '2': 0.145241581259,
    '3': 0.145241581259,
    '4': 0.145241581259,
    '5': 0.145241581259,
    '6': 0.145241581259,
    '7': 0.145241581259,
    '8': 0.145241581259,
    '9': 0.145241581259,
    ':': 0.0612737920937,
    ';': 0.0612737920937,
    '<': 0.145241581259,
    '=': 0.145241581259,
    '>': 0.145241581259,
    '?': 0.145241581259,
    '@': 0.270058565154,
    'A': 0.165666178624,
    'B': 0.161127379209,
    'C': 0.138433382138,
    'D': 0.163396778917,
    'E': 0.140702781845,
    'F': 0.140702781845,
    'G': 0.163396778917,
    'H': 0.165666178624,
    'I': 0.0612737920937,
    'J': 0.111200585652,
    'K': 0.161127379209,
    'L': 0.133894582723,
    'M': 0.186090775988,
    'N': 0.165666178624,
    'O': 0.161127379209,
    'P': 0.161127379209,
    'Q': 0.163396778917,
    'R': 0.161127379209,
    'S': 0.158857979502,
    'T': 0.145241581259,
    'U': 0.165666178624,
    'V': 0.165666178624,
    'W': 0.20878477306,
    'X': 0.170204978038,
    'Y': 0.165666178624,
    'Z': 0.158857979502,
    '[': 0.0839677891654,
    '\\': 0.165666178624,
    ']': 0.0839677891654,
    '^': 0.10439238653,
    '_': 0.186090775988,
    '`': 0.052196193265,
    'a': 0.149780380673,
    'b': 0.142972181552,
    'c': 0.118008784773,
    'd': 0.142972181552,
    'e': 0.140702781845,
    'f': 0.0953147877013,
    'g': 0.142972181552,
    'h': 0.145241581259,
    'i': 0.0612737920937,
    'j': 0.0612737920937,
    'k': 0.140702781845,
    'l': 0.0816983894583,
    'm': 0.186090775988,
    'n': 0.145241581259,
    'o': 0.140702781845,
    'p': 0.142972181552,
    'q': 0.142972181552,
    'r': 0.113469985359,
    's': 0.140702781845,
    't': 0.0953147877013,
    'u': 0.145241581259,
    'v': 0.129355783309,
    'w': 0.170204978038,
    'x': 0.133894582723,
    'y': 0.131625183016,
    'z': 0.133894582723,
    '{': 0.10439238653,
    '|': 0.0612737920937,
    '}': 0.10439238653,
    '~': 0.165666178624,
    '«': 0.145241581259,
    '°': 0.124816983895,
    '±': 0.145241581259,
    'µ': 0.152049780381,
    '·': 0.0612737920937,
    '»': 0.145241581259,
    'А': 0.165666178624,
    'Б': 0.161127379209,
    'В': 0.161127379209,
    'Г': 0.133894582723,
    'Д': 0.156588579795,
    'Е': 0.140702781845,
    'Ж': 0.190629575403,
    'З': 0.133894582723,
    'И': 0.165666178624,
    'Й': 0.165666178624,
    'К': 0.161127379209,
    'Л': 0.158857979502,
    'М': 0.186090775988,
    'Н': 0.165666178624,
    'О': 0.161127379209,
    'П': 0.165666178624,
    'Р': 0.161127379209,
    'С': 0.138433382138,
    'Т': 0.145241581259,
    'У': 0.163396778917,
    'Ф': 0.186090775988,
    'Х': 0.170204978038,
    'Ц': 0.172474377745,
    'Ч': 0.163396778917,
    'Ш': 0.20878477306,
    'Щ': 0.213323572474,
    'Ъ': 0.188360175695,
    'Ы': 0.186090775988,
    'Ь': 0.161127379209,
    'Э': 0.158857979502,
    'Ю': 0.183821376281,
    'Я': 0.161127379209,
    'а': 0.149780380673,
    'б': 0.140702781845,
    'в': 0.142972181552,
    'г': 0.140702781845,
    'д': 0.142972181552,
    'е': 0.140702781845,
    'ж': 0.174743777452,
    'з': 0.118008784773,
    'и': 0.145241581259,
    'й': 0.145241581259,
    'к': 0.140702781845,
    'л': 0.133894582723,
    'м': 0.165666178624,
    'н': 0.145241581259,
    'о': 0.140702781845,
    'п': 0.145241581259,
    'р': 0.142972181552,
    'с': 0.118008784773,
    'т': 0.186090775988,
    'у': 0.145241581259,
    'ф': 0.179282576867,
    'х': 0.133894582723,
    'ц': 0.152049780381,
    'ч': 0.142972181552,
    'ш': 0.186090775988,
    'щ': 0.19289897511,
    'ъ': 0.145241581259,
    'ы': 0.165666178624,
    'ь': 0.138433382138,
    'э': 0.138433382138,
    'ю': 0.163396778917,
    'я': 0.142972181552,
    'Ё': 0.140702781845,
    'Є': 0.158857979502,
    'І': 0.0612737920937,
    'Ї': 0.0839677891654,
    'ё': 0.140702781845,
    'є': 0.138433382138,
    'і': 0.0612737920937,
    'ї': 0.0839677891654,
    '℃': 0.249633967789,
    '℉': 0.249633967789,
    '№': 0.249633967789,
    "min": 0.052196193265,
    "max": 0.310907759883,
}

def getWidthFactor(text, size, width):
    """Масштаб шрифта.

    Рассчитать масштаб шрифта в процентах, необходимый для размещения
    текст с указанным размером шрифта в графе заданной ширины.

    Аргументы:
    text (str) -- текст, который необходимо поместить в графу;
    size (int) -- размер шрифта в пунктах;
    width (float) -- ширина графы в мм.

    Возвращаемое значение (int) -- соотношение ширины графы к ширине текста.

    """
    if not text:
        return 100
    textWidth = 0
    for char in text:
        if char in CHARWIDTH_MM_PER_POINT:
            textWidth += CHARWIDTH_MM_PER_POINT[char]
        else:
            textWidth += CHARWIDTH_MM_PER_POINT["max"]
    # Ширина текста измеряется с небольшой погрешностью.
    # Чтобы текст гарантировано поместился в графе,
    # достаточно добавить половину ширины наименьшего символа.
    textWidth += CHARWIDTH_MM_PER_POINT["min"] / 2
    textWidth *= size
    widthFactor = int((100 * width) / textWidth)
    widthFactor = max(widthFactor, 1)
    widthFactor = min(widthFactor, 100)
    return widthFactor
