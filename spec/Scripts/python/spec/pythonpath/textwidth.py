"""Модуль для вычисления ширины текста."""

CHAR_WIDTH_MM = {
    " ":{12:1.58565153734, 14:1.84992679356},
    "!":{12:0.792825768668, 14:0.792825768668},
    "\"":{12:1.05710102489, 14:1.32137628111},
    "#":{12:2.11420204978, 14:2.64275256223},
    "$":{12:2.11420204978, 14:2.378477306},
    "%":{12:3.69985358712, 14:4.22840409956},
    "&":{12:2.11420204978, 14:2.64275256223},
    "'":{12:0.528550512445, 14:0.792825768668},
    "(":{12:1.05710102489, 14:1.05710102489},
    ")":{12:1.05710102489, 14:1.05710102489},
    "*":{12:1.32137628111, 14:1.32137628111},
    "+":{12:1.84992679356, 14:2.11420204978},
    ",":{12:0.792825768668, 14:0.792825768668},
    "-":{12:1.84992679356, 14:2.11420204978},
    ".":{12:0.792825768668, 14:0.792825768668},
    "/":{12:2.11420204978, 14:2.378477306},
    "0":{12:1.84992679356, 14:2.11420204978},
    "1":{12:1.05710102489, 14:1.32137628111},
    "2":{12:1.84992679356, 14:2.11420204978},
    "3":{12:1.84992679356, 14:2.11420204978},
    "4":{12:1.84992679356, 14:2.11420204978},
    "5":{12:1.84992679356, 14:2.11420204978},
    "6":{12:1.84992679356, 14:2.11420204978},
    "7":{12:1.84992679356, 14:2.11420204978},
    "8":{12:1.84992679356, 14:2.11420204978},
    "9":{12:1.84992679356, 14:2.11420204978},
    ":":{12:0.792825768668, 14:0.792825768668},
    ";":{12:0.792825768668, 14:0.792825768668},
    "<":{12:1.84992679356, 14:2.11420204978},
    "=":{12:1.84992679356, 14:2.11420204978},
    ">":{12:1.84992679356, 14:2.11420204978},
    "?":{12:1.84992679356, 14:2.11420204978},
    "@":{12:3.17130307467, 14:3.69985358712},
    "A":{12:2.11420204978, 14:2.378477306},
    "B":{12:1.84992679356, 14:2.378477306},
    "C":{12:1.58565153734, 14:1.84992679356},
    "D":{12:1.84992679356, 14:2.378477306},
    "E":{12:1.58565153734, 14:1.84992679356},
    "F":{12:1.58565153734, 14:1.84992679356},
    "G":{12:1.84992679356, 14:2.378477306},
    "H":{12:2.11420204978, 14:2.378477306},
    "I":{12:0.792825768668, 14:0.792825768668},
    "J":{12:1.32137628111, 14:1.58565153734},
    "K":{12:1.84992679356, 14:2.378477306},
    "L":{12:1.58565153734, 14:1.84992679356},
    "M":{12:2.11420204978, 14:2.64275256223},
    "N":{12:2.11420204978, 14:2.378477306},
    "O":{12:1.84992679356, 14:2.378477306},
    "P":{12:1.84992679356, 14:2.378477306},
    "Q":{12:1.84992679356, 14:2.378477306},
    "R":{12:1.84992679356, 14:2.378477306},
    "S":{12:1.84992679356, 14:2.11420204978},
    "T":{12:1.84992679356, 14:2.11420204978},
    "U":{12:2.11420204978, 14:2.378477306},
    "V":{12:2.11420204978, 14:2.378477306},
    "W":{12:2.378477306, 14:2.90702781845},
    "X":{12:2.11420204978, 14:2.378477306},
    "Y":{12:2.11420204978, 14:2.378477306},
    "Z":{12:1.84992679356, 14:2.11420204978},
    "[":{12:1.05710102489, 14:1.05710102489},
    "\\":{12:2.11420204978, 14:2.378477306},
    "]":{12:1.05710102489, 14:1.05710102489},
    "^":{12:1.32137628111, 14:1.32137628111},
    "_":{12:2.11420204978, 14:2.64275256223},
    "`":{12:0.528550512445, 14:0.792825768668},
    "a":{12:1.84992679356, 14:2.11420204978},
    "b":{12:1.84992679356, 14:2.11420204978},
    "c":{12:1.32137628111, 14:1.58565153734},
    "d":{12:1.84992679356, 14:2.11420204978},
    "e":{12:1.58565153734, 14:1.84992679356},
    "f":{12:1.05710102489, 14:1.32137628111},
    "g":{12:1.84992679356, 14:2.11420204978},
    "h":{12:1.84992679356, 14:2.11420204978},
    "i":{12:0.792825768668, 14:0.792825768668},
    "j":{12:0.792825768668, 14:0.792825768668},
    "k":{12:1.58565153734, 14:1.84992679356},
    "l":{12:1.05710102489, 14:1.05710102489},
    "m":{12:2.11420204978, 14:2.64275256223},
    "n":{12:1.84992679356, 14:2.11420204978},
    "o":{12:1.58565153734, 14:1.84992679356},
    "p":{12:1.84992679356, 14:2.11420204978},
    "q":{12:1.84992679356, 14:2.11420204978},
    "r":{12:1.32137628111, 14:1.58565153734},
    "s":{12:1.58565153734, 14:1.84992679356},
    "t":{12:1.05710102489, 14:1.32137628111},
    "u":{12:1.84992679356, 14:2.11420204978},
    "v":{12:1.58565153734, 14:1.84992679356},
    "w":{12:2.11420204978, 14:2.378477306},
    "x":{12:1.58565153734, 14:1.84992679356},
    "y":{12:1.58565153734, 14:1.84992679356},
    "z":{12:1.58565153734, 14:1.84992679356},
    "{":{12:1.32137628111, 14:1.32137628111},
    "|":{12:0.792825768668, 14:0.792825768668},
    "}":{12:1.32137628111, 14:1.32137628111},
    "~":{12:2.11420204978, 14:2.378477306},
    "«":{12:1.84992679356, 14:2.11420204978},
    "°":{12:1.58565153734, 14:1.84992679356},
    "±":{12:1.84992679356, 14:2.11420204978},
    "µ":{12:1.84992679356, 14:2.11420204978},
    "·":{12:0.792825768668, 14:0.792825768668},
    "»":{12:1.84992679356, 14:2.11420204978},
    "А":{12:2.11420204978, 14:2.378477306},
    "Б":{12:1.84992679356, 14:2.378477306},
    "В":{12:1.84992679356, 14:2.378477306},
    "Г":{12:1.58565153734, 14:1.84992679356},
    "Д":{12:1.84992679356, 14:2.11420204978},
    "Е":{12:1.58565153734, 14:1.84992679356},
    "Ж":{12:2.378477306, 14:2.64275256223},
    "З":{12:1.58565153734, 14:1.84992679356},
    "И":{12:2.11420204978, 14:2.378477306},
    "Й":{12:2.11420204978, 14:2.378477306},
    "К":{12:1.84992679356, 14:2.378477306},
    "Л":{12:1.84992679356, 14:2.11420204978},
    "М":{12:2.11420204978, 14:2.64275256223},
    "Н":{12:2.11420204978, 14:2.378477306},
    "О":{12:1.84992679356, 14:2.378477306},
    "П":{12:2.11420204978, 14:2.378477306},
    "Р":{12:1.84992679356, 14:2.378477306},
    "С":{12:1.58565153734, 14:1.84992679356},
    "Т":{12:1.84992679356, 14:2.11420204978},
    "У":{12:1.84992679356, 14:2.378477306},
    "Ф":{12:2.11420204978, 14:2.64275256223},
    "Х":{12:2.11420204978, 14:2.378477306},
    "Ц":{12:2.11420204978, 14:2.378477306},
    "Ч":{12:1.84992679356, 14:2.378477306},
    "Ш":{12:2.378477306, 14:2.90702781845},
    "Щ":{12:2.64275256223, 14:2.90702781845},
    "Ъ":{12:2.378477306, 14:2.64275256223},
    "Ы":{12:2.11420204978, 14:2.64275256223},
    "Ь":{12:1.84992679356, 14:2.378477306},
    "Э":{12:1.84992679356, 14:2.11420204978},
    "Ю":{12:2.11420204978, 14:2.64275256223},
    "Я":{12:1.84992679356, 14:2.378477306},
    "а":{12:1.84992679356, 14:2.11420204978},
    "б":{12:1.58565153734, 14:1.84992679356},
    "в":{12:1.84992679356, 14:2.11420204978},
    "г":{12:1.58565153734, 14:1.84992679356},
    "д":{12:1.84992679356, 14:2.11420204978},
    "е":{12:1.58565153734, 14:1.84992679356},
    "ж":{12:2.11420204978, 14:2.378477306},
    "з":{12:1.32137628111, 14:1.58565153734},
    "и":{12:1.84992679356, 14:2.11420204978},
    "й":{12:1.84992679356, 14:2.11420204978},
    "к":{12:1.58565153734, 14:1.84992679356},
    "л":{12:1.58565153734, 14:1.84992679356},
    "м":{12:2.11420204978, 14:2.378477306},
    "н":{12:1.84992679356, 14:2.11420204978},
    "о":{12:1.58565153734, 14:1.84992679356},
    "п":{12:1.84992679356, 14:2.11420204978},
    "р":{12:1.84992679356, 14:2.11420204978},
    "с":{12:1.32137628111, 14:1.58565153734},
    "т":{12:2.11420204978, 14:2.64275256223},
    "у":{12:1.84992679356, 14:2.11420204978},
    "ф":{12:2.11420204978, 14:2.378477306},
    "х":{12:1.58565153734, 14:1.84992679356},
    "ц":{12:1.84992679356, 14:2.11420204978},
    "ч":{12:1.84992679356, 14:2.11420204978},
    "ш":{12:2.11420204978, 14:2.64275256223},
    "щ":{12:2.378477306, 14:2.64275256223},
    "ъ":{12:1.84992679356, 14:2.11420204978},
    "ы":{12:2.11420204978, 14:2.378477306},
    "ь":{12:1.58565153734, 14:1.84992679356},
    "э":{12:1.58565153734, 14:1.84992679356},
    "ю":{12:1.84992679356, 14:2.378477306},
    "я":{12:1.84992679356, 14:2.11420204978},
    "Ё":{12:1.58565153734, 14:1.84992679356},
    "Є":{12:1.84992679356, 14:2.11420204978},
    "І":{12:0.792825768668, 14:0.792825768668},
    "Ї":{12:1.05710102489, 14:1.05710102489},
    "ё":{12:1.58565153734, 14:1.84992679356},
    "є":{12:1.58565153734, 14:1.84992679356},
    "і":{12:0.792825768668, 14:0.792825768668},
    "ї":{12:1.05710102489, 14:1.05710102489},
    "℃":{12:2.90702781845, 14:3.43557833089},
    "℉":{12:2.90702781845, 14:3.43557833089},
    "№":{12:2.90702781845, 14:3.43557833089},
    "max":{12:3.69985358712, 14:4.22840409956},
}

def getWidthFactor(column, text):
    """Масштаб шрифта.

    Рассчитать масштаб шрифта в процентах, необходимый для того, чтобы
    текст поместился в указанной графе.

    Аргументы:
    column (str) -- наименование графы;
    text (str) -- текст, который необходимо поместить в графу.

    Возвращаемое значение (int) -- соотношение ширины графы к ширине текста.

    """
    supportedColumns = {
        "Поз. обозначение": (14, 19, 6),
        "Наименование": (14, 109, 37),
        "Кол.": (14, 9, 3),
        "Примечание": (14, 44, 14),
        "ФИО": (12, 21, 8),
    }
    if column not in supportedColumns:
        return 100
    fontSize, columnWidth, fitsAnyway = supportedColumns[column]
    if not text \
        or len(text) <= fitsAnyway:
            return 100
    textWidth = 0
    for char in text:
        if char in CHAR_WIDTH_MM:
            textWidth += CHAR_WIDTH_MM[char][fontSize]
        else:
            textWidth += CHAR_WIDTH_MM["max"][fontSize]
    widthFactor = int((100 * columnWidth) / textWidth)
    widthFactor = max(widthFactor, 1)
    widthFactor = min(widthFactor, 100)
    return widthFactor
